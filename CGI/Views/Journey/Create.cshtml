@using Microsoft.AspNetCore.Mvc.TagHelpers
@model Stopover

@{
    ViewData["Title"] = "Create Stopovers for Journey";
}
<body>
<style>
        #StopoverList::-webkit-scrollbar {
            width: 8px
               </style>

<script>
        document.addEventListener("DOMContentLoaded", function () {
            const stopoverList = document.getElementById("StopoverList");
            const submitJourneyBtn = document.getElementById("submitJourneyBtn");
            const form = document.querySelector("form");

            function createStopoverElement(stopover) {
                const div = document.createElement("div");
                div.classList.add("bg-white", "rounded", "shadow", "p-2", "mb-2", "border", "border-black");
                div.textContent = `Start: ${stopover.start}, End: ${stopover.end}, Vehicle: ${stopover.vehicle}, Distance: ${stopover.distance} km`;
                return div;
            }

            async function addStopover() {
                const stopover = {
                    start: form.startinglocation.value,
                    end: form.endlocation.value,
                    vehicle: form.vehicle.selectedOptions[0].text,
                    vehicleId: form.vehicle.value,
                    distance: form.distance.value,
                    journeyId: localStorage.getItem("JourneyID"),
                };

                // Replace this URL with the correct API endpoint for creating the stopover
                const response = await fetch("/StopOver/create", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(stopover),
                });

                if (response.ok) {
                    stopoverList.appendChild(createStopoverElement(stopover));
                    submitJourneyBtn.classList.remove("hidden");
                } else {
                    alert("Error adding stopover!");
                }
            }


            async function submitJourney() {
                const stopovers = [];
                for (const option of stopoverList.children) {
                    const stopover = {
                        start: option.start,
                        end: option.end,
                        vehicleId: option.vehicleId,
                        distance: option.distance,
                    };
                    stopovers.push(stopover);
                }

                // Replace this URL with the correct API endpoint for submitting the journey
                const response = await fetch("/api/journey", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ stopovers }),
                });

                if (response.ok) {
                    alert("Journey submitted successfully!");
                    window.location.href = "/"; // Redirect to a different page if necessary
                } else {
                    alert("Error submitting journey!");
                }
            }

            form.addEventListener("submit", (event) => {
                event.preventDefault();
                addStopover();
            });

            submitJourneyBtn.addEventListener("click", submitJourney);
        });
    </script>

<!-- Main layout of the page -->
<div class="flex justify-center items-center h-screen bg-slate-200">
    <div class="block bg-slate-100 p-6 rounded-lg shadow-md shadow-slate-300 w-90 grid grid-cols-2 gap-4">
        <div class=text-lg>Register new stopover:</div>
        <br>
        <div class="block bg-slate-50 p-6 rounded-lg shadow-md shadow-slate-300 w-90 max-h-96">
            <!-- Form for adding a new stopover -->
            <form>
                <!-- Input fields for starting location, end location, vehicle, and distance -->
                <label>Starting Location:</label>
                <br>
                <input asp-for="Start" class="shadow appearance-none border border-black rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" id="startinglocation" placeholder="Input starting location." required>
                <label>End Location:</label>
                <br>
                <input asp-for="End" class="shadow appearance-none border border-black rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" id="endlocation" placeholder="Input end location." required>
                <label>Vehicle:</label>
                <br>
                <select id="vehicle" asp-for="VehicleType" asp-items="Html.GetEnumSelectList<Vehicle_ID>()" class="shadow appearance-none border border-black rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" required>
                </select>
                <label>Distance in km:</label>
                <br>
                <input asp-for="Distance" class="shadow appearance-none border border-black rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" id="distance" placeholder="Input distance in km." required>
                <!-- Add button to submit the form -->
                <button class="bg-blue-700 rounded-lg w-full text-white min-h-fit">Add</button>
            </form>
        </div>
        <div class="block bg-slate-50 p-6 rounded-lg shadow-md shadow-slate-300 w-90 flex-none flex-col max-h-96">
            <div>Stopovers:</div>
            <!-- List to display stopovers -->
            <div class="overflow-y-scroll h-5/6" id="StopoverList"></div>
            <button id="submitJourneyBtn" class="bg-green-700 rounded-lg w-full text-white hidden">Submit Journey</button>
        </div>
    </div>
</div>

</body>
