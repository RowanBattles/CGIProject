@using Microsoft.AspNetCore.Mvc.TagHelpers
@model Stopover

@{
    ViewData["Title"] = "Create Stopovers for Journey";
}
<body>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
        $(function () {
            // Get the JourneyID from LocalStorage
            var journeyId = localStorage.getItem('JourneyID');

            // Set the value of the hidden field
            $('#journeyId').val(journeyId);

            $("form").on("submit", function (event) {
                event.preventDefault();

                // Get the selected option value
                var vehicleType = $("#vehicle option:selected").val();

                // Set the value of the hidden field to the enum value
                $('#VehicleType').val(vehicleType);

                console.log(vehicleType);

                var formData = $(this).serialize();

                $.post("/StopOver/CreateStopOver", formData, function (response) {
                    if (response.success) {
                        var stopover = response.stopover;
                        var stopoverItem = "<p>Start: " + stopover.start + ", End: " + stopover.end + ", Vehicle: " + vehicleType + ", Distance: " + stopover.distance + "km</p>";
                        $("#StopoverList").append(stopoverItem);
                        $("#submitJourneyBtn").removeClass("hidden");
                        $("form").trigger("reset");
                    } else {
                        alert("Error: Could not create stopover");
                    }
                });
            });

            $("#submitJourneyBtn").on("click", function () {
                // Get the JourneyID from LocalStorage
                var journeyId = localStorage.getItem('JourneyID');

                // Send a POST request to submit the journey data to the server
                $.post("/Journey/SubmitJourney", { journeyId: journeyId }, function (response) {
                    if (response.success) {
                        alert("Journey submitted successfully");
                    } else {
                        alert("Error: Could not submit journey");
                    }
                });
            });
        });
</script>

<!-- Main layout of the page -->
<div class="flex justify-center items-center h-screen bg-slate-200">
    <div class="block bg-slate-100 p-6 rounded-lg shadow-md shadow-slate-300 w-90 grid grid-cols-2 gap-4">
        <div class=text-lg>Register new stopover:</div>
        <br>
        <div class="block bg-slate-50 p-6 rounded-lg shadow-md shadow-slate-300 w-90 max-h-96">
            <!-- Form for adding a new stopover -->
            <form method="post" action="/StopOver/CreateStopOver">
                <input type="hidden" name="journeyId" id="journeyId" value="">
                <!-- Input fields for starting location, end location, vehicle, and distance -->
                <label>Starting Location:</label>
                <br>
                <input asp-for="Start" class="shadow appearance-none border border-black rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" id="startinglocation" placeholder="Input starting location." required>
                <label>End Location:</label>
                <br>
                <input asp-for="End" class="shadow appearance-none border border-black rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" id="endlocation" placeholder="Input end location." required>
                <label>Vehicle:</label>
                <br>
                <input type="hidden" asp-for="VehicleType" id="VehicleType"/>
                <select id="vehicle" class="shadow appearance-none border border-black rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" required>
                    @foreach (var item in Html.GetEnumSelectList<Vehicle_ID>())
                    {
                        <option value="@item.Value">@item.Text</option>
                    }
                </select>
                <label>Distance in km:</label>
                <br>
                <input asp-for="Distance" class="shadow appearance-none border border-black rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline" id="distance" placeholder="Input distance in km." required>
                <!-- Add button to submit the form -->
                <button class="bg-blue-700 rounded-lg w-full text-white min-h-fit">Add</button>
            </form>
        </div>
        <div class="block bg-slate-50 p-6 rounded-lg shadow-md shadow-slate-300 w-90 flex-none flex-col max-h-96">
            <div>Stopovers:</div>
            <!-- List to display stopovers -->
            <div class="overflow-y-scroll h-5/6" id="StopoverList"></div>
            <button id="submitJourneyBtn" class="bg-green-700 rounded-lg w-full text-white hidden">Submit Journey</button>
        </div>
    </div>
</div>
</body>